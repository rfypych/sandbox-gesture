<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandboxels with Gesture Control - Integration Guide</title>
    <style>
        body {
            font-family: 'Press Start 2P', monospace;
            background: #000;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .code-block {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            overflow-x: auto;
        }
        .highlight {
            color: #4CAF50;
        }
        .warning {
            color: #ff9800;
            background: #2a1a00;
            padding: 10px;
            border-left: 4px solid #ff9800;
            margin: 15px 0;
        }
        .step {
            background: #1a1a2e;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Sandboxels Gesture Control Integration</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Important:</strong> This integration requires HTTPS for camera access. Make sure your hosting service supports SSL certificates.
        </div>

        <h2>üìã Integration Steps</h2>

        <div class="step">
            <h3>Step 1: Add MediaPipe Dependencies</h3>
            <p>Add these script tags to your index.html before the closing &lt;/body&gt; tag:</p>
            <div class="code-block">
&lt;!-- MediaPipe Hands --&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"&gt;&lt;/script&gt;

&lt;!-- Gesture Control System --&gt;
&lt;script src="gesture-control.js"&gt;&lt;/script&gt;
&lt;script src="gesture-ui.js"&gt;&lt;/script&gt;
            </div>
        </div>

        <div class="step">
            <h3>Step 2: Add Initialization Code</h3>
            <p>Add this initialization code after the existing Sandboxels JavaScript:</p>
            <div class="code-block">
&lt;script&gt;
// Initialize Gesture Control after game loads
window.addEventListener('load', function() {
    // Wait for Sandboxels to fully initialize
    setTimeout(() => {
        if (window.gestureController && window.gestureUI) {
            console.log('Gesture Control initialized successfully');
            
            // Add gesture control info to help menu
            if (typeof addHelpSection === 'function') {
                addHelpSection('Gesture Control', `
                    &lt;p&gt;Control Sandboxels with hand gestures:&lt;/p&gt;
                    &lt;ul&gt;
                        &lt;li&gt;üëÜ Point to draw&lt;/li&gt;
                        &lt;li&gt;‚úåÔ∏è Peace sign to erase&lt;/li&gt;
                        &lt;li&gt;ü§è Pinch to select element&lt;/li&gt;
                        &lt;li&gt;‚úã Open palm to pause/play&lt;/li&gt;
                        &lt;li&gt;‚úä Fist to reset&lt;/li&gt;
                        &lt;li&gt;üëçüëé Thumbs up/down for brush size&lt;/li&gt;
                    &lt;/ul&gt;
                    &lt;p&gt;Press Ctrl+Shift+G to open gesture control panel.&lt;/p&gt;
                `);
            }
        }
    }, 2000);
});

// Add gesture control to mod system if available
if (typeof runAfterLoad === 'function') {
    runAfterLoad(function() {
        // Gesture control is now available as a "mod"
        console.log('Gesture Control loaded as mod');
    });
}
&lt;/script&gt;
            </div>
        </div>

        <div class="step">
            <h3>Step 3: Update Manifest for Camera Permissions</h3>
            <p>Update your manifest.json to request camera permissions:</p>
            <div class="code-block">
{
  "name": "Sandboxels",
  "short_name": "Sandboxels",
  "theme_color": "#000000",
  "background_color": "#000000",
  "display": "standalone",
  "scope": "/",
  "start_url": "https://your-domain.com",
  "description": "A falling sand simulation game with gesture control",
  "orientation": "any",
  <span class="highlight">"permissions": ["camera"],</span>
  "icons": [
    // ... your existing icons
  ]
}
            </div>
        </div>

        <div class="step">
            <h3>Step 4: Add Privacy Policy Section</h3>
            <p>Add camera usage information to your privacy policy or create a new section:</p>
            <div class="code-block">
&lt;div id="camera-privacy-notice" style="display:none;"&gt;
    &lt;h3&gt;Camera Usage&lt;/h3&gt;
    &lt;p&gt;Sandboxels uses your camera for gesture control features. 
       All processing is done locally in your browser. 
       No video data is sent to our servers or stored anywhere.&lt;/p&gt;
    &lt;p&gt;You can disable gesture control at any time in the settings.&lt;/p&gt;
&lt;/div&gt;
            </div>
        </div>

        <h2>üöÄ Deployment Recommendations</h2>

        <div class="step">
            <h3>Hosting Services</h3>
            <p>Recommended hosting services that support HTTPS and camera permissions:</p>
            <ul>
                <li><strong>Netlify</strong> - Free tier with automatic HTTPS</li>
                <li><strong>Vercel</strong> - Excellent for static sites</li>
                <li><strong>GitHub Pages</strong> - Free with custom domain HTTPS</li>
                <li><strong>Firebase Hosting</strong> - Google's hosting with SSL</li>
                <li><strong>Cloudflare Pages</strong> - Fast global CDN</li>
            </ul>
        </div>

        <div class="step">
            <h3>Performance Optimization</h3>
            <p>For better performance with gesture control:</p>
            <ul>
                <li>Enable gzip compression on your server</li>
                <li>Use CDN for MediaPipe libraries</li>
                <li>Implement lazy loading for gesture features</li>
                <li>Add service worker caching for offline support</li>
            </ul>
        </div>

        <h2>üîß Configuration Options</h2>

        <div class="step">
            <h3>Customizing Gesture Sensitivity</h3>
            <div class="code-block">
// Add to your initialization code
window.addEventListener('load', function() {
    if (window.gestureController) {
        // Adjust sensitivity (0.3 - 0.9)
        gestureController.hands.setOptions({
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7
        });
        
        // Adjust smoothing (3-10 frames)
        gestureController.smoothingFrames = 7;
    }
});
            </div>
        </div>

        <div class="step">
            <h3>Adding Custom Gestures</h3>
            <div class="code-block">
// Example: Add a custom "OK" gesture
gestureController.gestureCallbacks['ok_sign'] = function(gesture) {
    // Custom action for OK gesture
    console.log('OK gesture detected!');
    // Add your custom functionality here
};

// Update the gesture recognition
const originalClassify = gestureController.classifyHandGesture;
gestureController.classifyHandGesture = function(landmarks) {
    // Check for OK gesture (thumb and index forming circle)
    const thumbTip = landmarks[4];
    const indexTip = landmarks[8];
    const distance = Math.sqrt(
        Math.pow(thumbTip.x - indexTip.x, 2) + 
        Math.pow(thumbTip.y - indexTip.y, 2)
    );
    
    if (distance < 0.03) {
        return 'ok_sign';
    }
    
    // Fall back to original classification
    return originalClassify.call(this, landmarks);
};
            </div>
        </div>

        <h2>üêõ Troubleshooting</h2>

        <div class="step">
            <h3>Common Issues</h3>
            <ul>
                <li><strong>Camera not working:</strong> Ensure HTTPS and camera permissions</li>
                <li><strong>Poor gesture detection:</strong> Check lighting and hand position</li>
                <li><strong>High CPU usage:</strong> Reduce detection frequency or model complexity</li>
                <li><strong>Gestures not responding:</strong> Adjust sensitivity settings</li>
            </ul>
        </div>

        <div class="step">
            <h3>Debug Mode</h3>
            <div class="code-block">
// Enable debug mode for gesture control
window.addEventListener('load', function() {
    if (window.gestureController) {
        // Show hand landmarks overlay
        gestureController.showGestureOverlay(true);
        
        // Log gesture detection
        const originalProcess = gestureController.processGesture;
        gestureController.processGesture = function(gesture, landmarks) {
            console.log('Gesture detected:', gesture);
            return originalProcess.call(this, gesture, landmarks);
        };
    }
});
            </div>
        </div>

        <h2>üì± Mobile Considerations</h2>

        <div class="step">
            <h3>Mobile Optimization</h3>
            <p>For mobile devices, consider these adjustments:</p>
            <div class="code-block">
// Detect mobile and adjust settings
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

if (isMobile && window.gestureController) {
    // Reduce model complexity for mobile
    gestureController.hands.setOptions({
        modelComplexity: 0,
        maxNumHands: 1
    });
    
    // Adjust camera resolution
    gestureController.camera = new Camera(gestureController.videoElement, {
        onFrame: async () => {
            if (gestureController.isEnabled) {
                await gestureController.hands.send({ image: gestureController.videoElement });
            }
        },
        width: 320,  // Reduced for mobile
        height: 240
    });
}
            </div>
        </div>

        <div class="warning">
            <strong>üì± Note:</strong> iOS Safari requires user interaction before accessing camera. Consider adding a "Start Gesture Control" button that users must click.
        </div>

        <h2>üéØ Next Steps</h2>
        
        <ol>
            <li>Copy the gesture-control.js and gesture-ui.js files to your project</li>
            <li>Add the MediaPipe script tags to your HTML</li>
            <li>Update your manifest.json for camera permissions</li>
            <li>Deploy to an HTTPS-enabled hosting service</li>
            <li>Test gesture control functionality</li>
            <li>Customize gestures and sensitivity as needed</li>
        </ol>

        <div class="step">
            <h3>üöÄ Ready to Deploy?</h3>
            <p>Your Sandboxels game with gesture control is ready! Users will be able to:</p>
            <ul>
                <li>Draw and erase with hand gestures</li>
                <li>Control game functions without touching the screen</li>
                <li>Enjoy an immersive, hands-free gaming experience</li>
                <li>Access gesture control on any modern browser with camera support</li>
            </ul>
        </div>
    </div>

    <script>
        // Add some interactive elements to this guide
        document.addEventListener('DOMContentLoaded', function() {
            // Add copy buttons to code blocks
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => {
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy';
                copyBtn.style.cssText = `
                    position: absolute;
                    top: 5px;
                    right: 5px;
                    background: #4CAF50;
                    color: white;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-size: 10px;
                `;
                
                block.style.position = 'relative';
                block.appendChild(copyBtn);
                
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(block.textContent.replace('Copy', '').trim());
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => copyBtn.textContent = 'Copy', 2000);
                };
            });
        });
    </script>
</body>
</html>
