<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Particle Hand Game - Standalone</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
        font-family: 'Arial', sans-serif;
      }
      
      #app {
        width: 100vw;
        height: 100vh;
        position: relative;
      }
      
      #gameCanvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }
      
      #videoElement {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 200px;
        height: 150px;
        border: 2px solid #fff;
        border-radius: 10px;
        z-index: 2;
        transform: scaleX(-1);
      }
      
      #ui {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        z-index: 3;
        font-size: 14px;
      }
      
      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 24px;
        z-index: 4;
      }
      
      .instructions {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        text-align: center;
        z-index: 4;
        background: rgba(0, 0, 0, 0.8);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        max-width: 80%;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }
      
      .instructions.hidden {
        display: none;
      }
      
      .control-btn {
        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        margin: 10px 5px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }
      
      .control-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }
      
      .demo-mode {
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      @media (max-width: 768px) {
        #videoElement {
          width: 120px;
          height: 90px;
        }
        
        #ui {
          font-size: 12px;
        }
        
        .instructions {
          font-size: 14px;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <canvas id="gameCanvas"></canvas>
      <video id="videoElement" autoplay muted playsinline style="display: none;"></video>
      <div id="ui">
        <div>FPS: <span id="fps">0</span></div>
        <div>Particles: <span id="particleCount">0</span></div>
        <div>Mode: <span id="currentMode">Touch</span></div>
      </div>
      
      <div id="instructions" class="instructions">
        <h2>üéÆ Particle Hand Game</h2>
        <p><strong>Demo Mode - Touch Controls</strong></p>
        <p>üñ±Ô∏è <strong>Click & Drag:</strong> Attract particles</p>
        <p>üì± <strong>Touch & Drag:</strong> Control particles on mobile</p>
        <p>üé® <strong>Multiple Touches:</strong> Create multiple attraction points</p>
        
        <div class="demo-mode">
          <h3>üåå COSMIC FORMATION SYSTEM</h3>
          <p>Witness the birth of a cosmic constellation spelling "COSMOS"!</p>
          <p>üñ±Ô∏è <strong>Gravitational Lensing:</strong> Mouse bends spacetime around particles</p>
          <p>üåü <strong>Stellar Formation:</strong> Particles form into cosmic constellation</p>
          <p>üåå <strong>Cosmic Void:</strong> Particles disperse into deep space</p>
          <p>üí• <strong>Big Bang:</strong> Trigger cosmic explosion and rebirth</p>
          <p><strong>‚ö° Experience real cosmic physics in your browser!</strong></p>
        </div>

        <button id="startBtn" class="control-btn">üöÄ Enter Cosmos</button>
        <div style="margin-top: 10px;">
          <button id="formBtn" class="control-btn">üåü Form Constellation</button>
          <button id="disperseBtn" class="control-btn">üåå Cosmic Void</button>
          <button id="bigBangBtn" class="control-btn" style="background: linear-gradient(45deg, #FF0080, #00FFFF); color: white; font-weight: bold;">üí• BIG BANG</button>
        </div>
      </div>
      
      <div id="loading" class="loading" style="display: none;">Initializing...</div>
    </div>

    <script>
      // Particle Formation System (like the original)
      class Particle {
        constructor(x, y) {
          this.x = x; // Posisi x saat ini
          this.y = y; // Posisi y saat ini
          this.size = 2.5; // Ukuran partikel
          this.baseX = this.x; // Posisi x target (dalam bentuk objek)
          this.baseY = this.y; // Posisi y target (dalam bentuk objek)
          this.density = (Math.random() * 40) + 5; // Faktor "berat" atau inersia
          this.originX = Math.random() * canvas.width; // Posisi awal x yang acak
          this.originY = Math.random() * canvas.height; // Posisi awal y yang acak
          this.targetX = this.originX; // Posisi tujuan x saat ini
          this.targetY = this.originY; // Posisi tujuan y saat ini
          this.color = `hsl(${Math.random() * 360}, 80%, 60%)`; // Warna acak
        }

        // Memperbarui posisi partikel di setiap frame
        update() {
          // Interaksi dengan mouse: mendorong partikel menjauh
          let dxMouse = this.x - mouse.x;
          let dyMouse = this.y - mouse.y;
          let distanceMouse = Math.sqrt(dxMouse * dxMouse + dyMouse * dyMouse);

          if (distanceMouse < mouse.radius) {
            // Partikel berada dalam jangkauan mouse
            let forceDirectionX = dxMouse / distanceMouse;
            let forceDirectionY = dyMouse / distanceMouse;
            let force = (mouse.radius - distanceMouse) / mouse.radius;
            let directionX = forceDirectionX * force * this.density * 0.8;
            let directionY = forceDirectionY * force * this.density * 0.8;
            this.x += directionX;
            this.y += directionY;
          } else {
            // Jika tidak ada interaksi mouse, partikel bergerak ke targetnya
            let dxTarget = this.targetX - this.x;
            let dyTarget = this.targetY - this.y;
            this.x += dxTarget / 20; // Faktor 20 menentukan kecepatan konvergensi
            this.y += dyTarget / 20;
          }
        }

        // Menggambar partikel ke kanvas
        draw() {
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.closePath();
          ctx.fill();
        }


      }

      // Global variables
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      let particlesArray = [];
      const textToForm = 'COSMOS';

      // Mouse object
      const mouse = {
        x: null,
        y: null,
        radius: 100
      };

      // Setup canvas
      let canvasWidth = window.innerWidth * 0.9;
      if (canvasWidth > 800) canvasWidth = 800;
      let canvasHeight = canvasWidth * 0.5;
      if (canvasHeight < 300) canvasHeight = 300;

      canvas.width = canvasWidth;
      canvas.height = canvasHeight;

      // Event listeners
      canvas.addEventListener('mousemove', (event) => {
        const rect = canvas.getBoundingClientRect();
        mouse.x = event.clientX - rect.left;
        mouse.y = event.clientY - rect.top;
      });

      canvas.addEventListener('mouseout', () => {
        mouse.x = null;
        mouse.y = null;
      });

      canvas.addEventListener('touchmove', (event) => {
        event.preventDefault();
        const rect = canvas.getBoundingClientRect();
        mouse.x = event.touches[0].clientX - rect.left;
        mouse.y = event.touches[0].clientY - rect.top;
      });

      canvas.addEventListener('touchend', () => {
        mouse.x = null;
        mouse.y = null;
      });

      // Initialize particles from text
      function init() {
        particlesArray = [];
        ctx.fillStyle = 'white';
        const fontSize = Math.floor(canvas.width / 6);
        ctx.font = `bold ${fontSize}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(textToForm, canvas.width / 2, canvas.height / 2);

        const textCoordinates = ctx.getImageData(0, 0, canvas.width, canvas.height);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const gap = 4;
        for (let y = 0; y < textCoordinates.height; y += gap) {
          for (let x = 0; x < textCoordinates.width; x += gap) {
            if (textCoordinates.data[(y * 4 * textCoordinates.width) + (x * 4) + 3] > 128) {
              particlesArray.push(new Particle(x, y));
            }
          }
        }
      }

      // Animation loop
      function animate() {
        ctx.fillStyle = 'rgba(17, 24, 39, 0.25)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < particlesArray.length; i++) {
          particlesArray[i].update();
          particlesArray[i].draw();
        }
        requestAnimationFrame(animate);
      }

      // Form shape function
      function formShape() {
        for (let i = 0; i < particlesArray.length; i++) {
          particlesArray[i].targetX = particlesArray[i].baseX;
          particlesArray[i].targetY = particlesArray[i].baseY;
        }
      }

      // Disperse shape function
      function disperseShape() {
        for (let i = 0; i < particlesArray.length; i++) {
          particlesArray[i].targetX = Math.random() * canvas.width;
          particlesArray[i].targetY = Math.random() * canvas.height;
        }
      }

      // Handle window resize
      window.addEventListener('resize', () => {
        canvasWidth = window.innerWidth * 0.9;
        if (canvasWidth > 800) canvasWidth = 800;
        canvasHeight = canvasWidth * 0.5;
        if (canvasHeight < 300) canvasHeight = 300;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        init();
      });

      // Event listeners for buttons
      document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('instructions').classList.add('hidden');
        init();
        animate();
        console.log('üåü Particle Formation Demo Started!');
        console.log('üñ±Ô∏è Move mouse to push particles away');
        console.log('üé® Use Form/Disperse buttons to control particles');
      });

      document.getElementById('formBtn').addEventListener('click', formShape);
      document.getElementById('disperseBtn').addEventListener('click', disperseShape);
      document.getElementById('bigBangBtn').addEventListener('click', triggerBigBang);

      // Big Bang function
      function triggerBigBang() {
        // Cosmic explosion effect
        for (let i = 0; i < particlesArray.length; i++) {
          const particle = particlesArray[i];
          const explosionAngle = Math.random() * Math.PI * 2;
          const explosionForce = Math.random() * 20 + 10;

          particle.targetX = particle.x + Math.cos(explosionAngle) * explosionForce * 10;
          particle.targetY = particle.y + Math.sin(explosionAngle) * explosionForce * 10;

          // Enhance particle properties for explosion
          particle.size *= 2;
          particle.energy = 5;
        }

        // Reset after explosion
        setTimeout(() => {
          formShape();
          for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].size = 2.5;
            particlesArray[i].energy = 1;
          }
        }, 2000);

        console.log('üí• BIG BANG! Cosmic explosion triggered!');
      }
    </script>
  </body>
</html>
